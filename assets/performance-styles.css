/* Performance and Reliability Styles */

/* ===========================
   Performance Optimizations
   =========================== */

/* Use GPU acceleration for animations */
.view-section,
.slide,
.journey-node,
.metric-card,
.story-chapter,
.phase,
.decision-column {
  will-change: transform;
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* Optimize animation performance */
* {
  animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}

/* Reduce motion for accessibility and performance */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* Pause animations when page is hidden */
body.animations-paused *,
body.animations-paused *::before,
body.animations-paused *::after {
  animation-play-state: paused !important;
}

/* ===========================
   Loading States
   =========================== */

/* Prevent layout shift during loading */
img {
  aspect-ratio: attr(width) / attr(height);
  width: 100%;
  height: auto;
}

/* Skeleton screens for content */
.loading-skeleton {
  background: linear-gradient(
    90deg,
    rgba(255, 255, 255, 0.05) 25%,
    rgba(255, 255, 255, 0.1) 50%,
    rgba(255, 255, 255, 0.05) 75%
  );
  background-size: 200% 100%;
  animation: skeleton-loading 1.5s ease-in-out infinite;
}

@keyframes skeleton-loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* ===========================
   Scroll Optimizations
   =========================== */

/* Smooth scroll with fallback */
html {
  scroll-behavior: smooth;
}

/* Optimize scrollbar */
::-webkit-scrollbar {
  width: 12px;
  height: 12px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 6px;
  border: 3px solid transparent;
  background-clip: padding-box;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.2);
}

/* Scroll padding for fixed header */
html {
  scroll-padding-top: 80px;
}

/* ===========================
   Touch Optimizations
   =========================== */

/* Improve touch targets */
button,
.journey-node,
.view-toggle,
.slide-dot {
  min-width: 44px;
  min-height: 44px;
  touch-action: manipulation;
}

/* Prevent accidental zoom on double tap */
button,
input,
select,
textarea {
  touch-action: manipulation;
}

/* Improve swipe areas */
.slide-container {
  touch-action: pan-y pinch-zoom;
}

/* ===========================
   State Feedback
   =========================== */

/* Clear focus indicators */
:focus {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

:focus:not(:focus-visible) {
  outline: none;
}

:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

/* Active states */
button:active,
.journey-node:active {
  transform: scale(0.98);
}

/* Disabled states */
button:disabled,
.journey-node.disabled {
  opacity: 0.5;
  cursor: not-allowed;
  pointer-events: none;
}

/* Loading states */
button.loading {
  position: relative;
  color: transparent;
}

button.loading::after {
  content: '';
  position: absolute;
  width: 20px;
  height: 20px;
  top: 50%;
  left: 50%;
  margin-left: -10px;
  margin-top: -10px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: button-loading 0.8s linear infinite;
}

@keyframes button-loading {
  to { transform: rotate(360deg); }
}

/* ===========================
   Error States
   =========================== */

.error-message {
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.3);
  color: #ef4444;
  padding: 1rem;
  border-radius: 0.5rem;
  margin: 1rem 0;
  animation: shake 0.5s ease-in-out;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
  20%, 40%, 60%, 80% { transform: translateX(5px); }
}

/* ===========================
   Transition States
   =========================== */

/* Prevent interaction during transitions */
body.is-transitioning {
  pointer-events: none;
}

body.is-transitioning * {
  cursor: wait !important;
}

/* Smooth state transitions */
.view-section {
  transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s ease;
}

.view-section:not(.active) {
  opacity: 0;
  visibility: hidden;
  transform: translateY(20px);
  pointer-events: none;
}

.view-section.active {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
  pointer-events: auto;
}

/* ===========================
   Memory Optimizations
   =========================== */

/* Hide expensive animations when scrolled out of view */
body.scrolled .hero-gradient {
  animation-play-state: paused;
}

/* Simplify shadows at distance */
.scrolled .metric-card,
.scrolled .journey-node {
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* ===========================
   Browser Compatibility
   =========================== */

/* Fallback for backdrop-filter */
@supports not (backdrop-filter: blur(10px)) {
  .metric-card,
  .phase,
  .story-chapter {
    background: rgba(26, 26, 46, 0.95);
  }
}

/* Fallback for gap property */
@supports not (gap: 1rem) {
  .metrics-grid > * {
    margin: 0.5rem;
  }
  
  .journey-nodes > * {
    margin: 0 1rem;
  }
}

/* Edge/IE fallbacks */
@media screen and (-ms-high-contrast: active), (-ms-high-contrast: none) {
  .view-section {
    transition: none;
  }
  
  .metric-card {
    background: #1a1a2e;
  }
}

/* ===========================
   Print Optimizations
   =========================== */

@media print {
  .site-header,
  .slide-controls,
  .view-nav,
  button {
    display: none !important;
  }
  
  .view-section {
    page-break-inside: avoid;
  }
  
  * {
    animation: none !important;
    transition: none !important;
  }
}